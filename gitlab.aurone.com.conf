<VirtualHost *:80>
SuexecUserGroup "#1302" "#1297"
ServerName gitlab.aurone.com
ServerAlias www.gitlab.aurone.com
ServerAlias webmail.gitlab.aurone.com
ServerAlias admin.gitlab.aurone.com
DocumentRoot /home/gitlab/public_html
ErrorLog /var/log/virtualmin/gitlab.aurone.com_error_log
CustomLog /var/log/virtualmin/gitlab.aurone.com_access_log combined
ScriptAlias /cgi-bin/ /home/gitlab/cgi-bin/
DirectoryIndex index.html index.htm index.php index.php4 index.php5
<Directory /home/gitlab/public_html>
Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch +ExecCGI
allow from all
AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
Require all granted
AddType application/x-httpd-php .php
AddHandler fcgid-script .php
AddHandler fcgid-script .php5
AddHandler fcgid-script .php7.0
AddHandler fcgid-script .php7.1
AddHandler fcgid-script .php7.2
AddHandler fcgid-script .php7.3
AddHandler fcgid-script .php7.4
FCGIWrapper /home/gitlab/fcgi-bin/php5.fcgi .php
FCGIWrapper /home/gitlab/fcgi-bin/php5.fcgi .php5
FCGIWrapper /home/gitlab/fcgi-bin/php7.0.fcgi .php7.0
FCGIWrapper /home/gitlab/fcgi-bin/php7.1.fcgi .php7.1
FCGIWrapper /home/gitlab/fcgi-bin/php7.2.fcgi .php7.2
FCGIWrapper /home/gitlab/fcgi-bin/php7.3.fcgi .php7.3
FCGIWrapper /home/gitlab/fcgi-bin/php7.4.fcgi .php7.4
</Directory>
<Directory /home/gitlab/cgi-bin>
allow from all
AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
Require all granted
</Directory>
RewriteEngine on
RewriteCond %{HTTP_HOST} =webmail.gitlab.aurone.com
RewriteRule ^(.*) https://gitlab.aurone.com:20000/ [R]
RewriteCond %{HTTP_HOST} =admin.gitlab.aurone.com
RewriteRule ^(.*) https://gitlab.aurone.com:10000/ [R]
RewriteCond %{HTTPS} off
RewriteCond %{REQUEST_URI} !\.well-known/acme-challenge
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
RemoveHandler .php
RemoveHandler .php5
RemoveHandler .php7.0
RemoveHandler .php7.1
RemoveHandler .php7.2
RemoveHandler .php7.3
RemoveHandler .php7.4
php_admin_value engine Off
FcgidMaxRequestLen 1073741824
Alias /dav /home/gitlab/public_html
<Location /dav>
DAV on
AuthType Basic
AuthName "gitlab.aurone.com"
AuthUserFile /home/gitlab/etc/dav.digest.passwd
Require valid-user
ForceType text/plain
Satisfy All
RemoveHandler .php
RemoveHandler .php5
RemoveHandler .php7.0
RemoveHandler .php7.2
RewriteEngine off
</Location>
IPCCommTimeout 181
ProxyPass / https://192.168.3.122/
ProxyPassReverse / https://192.168.3.122/
SSLProxyEngine on
<Proxy *>
allow from all
</Proxy>
</VirtualHost>
<VirtualHost *:443>
SuexecUserGroup "#1302" "#1297"
ServerName gitlab.aurone.com
ServerAlias www.gitlab.aurone.com
ServerAlias webmail.gitlab.aurone.com
ServerAlias admin.gitlab.aurone.com
DocumentRoot /home/gitlab/public_html
ErrorLog /var/log/virtualmin/gitlab.aurone.com_error_log
CustomLog /var/log/virtualmin/gitlab.aurone.com_access_log combined
ScriptAlias /cgi-bin/ /home/gitlab/cgi-bin/
DirectoryIndex index.html index.htm index.php index.php4 index.php5
<Directory /home/gitlab/public_html>
Options -Indexes +IncludesNOEXEC +SymLinksIfOwnerMatch +ExecCGI
allow from all
AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
Require all granted
AddType application/x-httpd-php .php
AddHandler fcgid-script .php
AddHandler fcgid-script .php5
AddHandler fcgid-script .php7.0
AddHandler fcgid-script .php7.1
AddHandler fcgid-script .php7.2
AddHandler fcgid-script .php7.3
AddHandler fcgid-script .php7.4
FCGIWrapper /home/gitlab/fcgi-bin/php5.fcgi .php
FCGIWrapper /home/gitlab/fcgi-bin/php5.fcgi .php5
FCGIWrapper /home/gitlab/fcgi-bin/php7.0.fcgi .php7.0
FCGIWrapper /home/gitlab/fcgi-bin/php7.1.fcgi .php7.1
FCGIWrapper /home/gitlab/fcgi-bin/php7.2.fcgi .php7.2
FCGIWrapper /home/gitlab/fcgi-bin/php7.3.fcgi .php7.3
FCGIWrapper /home/gitlab/fcgi-bin/php7.4.fcgi .php7.4
</Directory>
<Directory /home/gitlab/cgi-bin>
allow from all
AllowOverride All Options=ExecCGI,Includes,IncludesNOEXEC,Indexes,MultiViews,SymLinksIfOwnerMatch
Require all granted
</Directory>
RewriteEngine on
RewriteCond %{HTTP_HOST} =webmail.gitlab.aurone.com
RewriteRule ^(.*) https://gitlab.aurone.com:20000/ [R]
RewriteCond %{HTTP_HOST} =admin.gitlab.aurone.com
RewriteRule ^(.*) https://gitlab.aurone.com:10000/ [R]
RewriteCond %{HTTPS} off
RewriteCond %{REQUEST_URI} !\.well-known/acme-challenge
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
RemoveHandler .php
RemoveHandler .php5
RemoveHandler .php7.0
RemoveHandler .php7.1
RemoveHandler .php7.2
RemoveHandler .php7.3
RemoveHandler .php7.4
php_admin_value engine Off
FcgidMaxRequestLen 1073741824
Alias /dav /home/gitlab/public_html
<Location /dav>
DAV on
AuthType Basic
AuthName "gitlab.aurone.com"
AuthUserFile /home/gitlab/etc/dav.digest.passwd
Require valid-user
ForceType text/plain
Satisfy All
RemoveHandler .php
RemoveHandler .php5
RemoveHandler .php7.0
RemoveHandler .php7.2
RewriteEngine off
</Location>
IPCCommTimeout 181
ProxyPass / https://192.168.3.122/
ProxyPassReverse / https://192.168.3.122/
SSLProxyEngine on
<Proxy *>
allow from all
</Proxy>
SSLEngine on
SSLCertificateFile /home/gitlab/ssl.cert
SSLCertificateKeyFile /home/gitlab/ssl.key
SSLCACertificateFile /home/gitlab/ssl.ca
SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1

SSLProxyVerify none 
SSLProxyCheckPeerCN off
SSLProxyCheckPeerName off
SSLProxyCheckPeerExpire off
</VirtualHost>
